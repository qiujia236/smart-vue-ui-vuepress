(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{474:function(e,t,n){},574:function(e,t,n){"use strict";n(474)},598:function(e,t,n){"use strict";n.r(t);n(208),n(115),n(59),n(387),n(81),n(381),n(55),n(116),n(122);var a=n(76);n(11);function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"base64";return new Promise((function(n){var a=new FileReader;"base64"===t?a.readAsDataURL(e):"buffer"===t&&a.readAsArrayBuffer(e),a.onload=function(e){n(e.target.result)}}))}var i=n(553),s=n.n(i),o=n(570),u=n.n(o),l=n(571),c=n.n(l),p={name:"my-uploader",props:{size:{type:Number,default:4194304},bufferCount:{type:Number,default:50}},data:function(){return{total:0,btn:!1,smallFile:!1,bigFile:!1,video:[],img:[],otherFile:[],filename:"",flag:!1}},filters:{btnText:function(e){return e?"继续":"暂停"},totalText:function(e){return e>100?100:e}},methods:{error:function(e){e.target.style.display="none"},clickUpload:function(e){!0!==this.flag?(e.preventDefault(),this.$refs.uploadOriginal.click()):alert("正在上传文件，请稍后尝试")},changFile:function(){var e=this;return Object(a.a)(regeneratorRuntime.mark((function t(){var n,a,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.$refs.uploadOriginal,a=n.files[0],r=a.name,!(a.size<e.size)){t.next=12;break}return e.smallFile=!0,e.filename=r,e.flag=!0,t.next=9,e.changeFileAsBase64(a);case 9:return t.abrupt("return",!1);case 12:return e.bigFile=!0,e.filename=r,e.flag=!0,t.next=17,e.changeFileAsBuffer(a);case 17:return t.abrupt("return",!1);case 18:case"end":return t.stop()}}),t)})))()},changeFileAsBase64:function(e){var t=this;return Object(a.a)(regeneratorRuntime.mark((function n(){var a,i;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,r(e,"base64");case 4:return a=n.sent,n.next=7,s.a.post("https://express-vue-components.herokuapp.com/single2",c.a.stringify({chunk:encodeURIComponent(a),filename:e.name}),{headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 7:if(0!=(a=(a=n.sent).data).code){n.next=15;break}return i=/\.([0-9a-zA-Z]+)$/.exec(a.path)[1],/(png|gif|jpeg|jpg)/i.test(i)?t.img.push({id:Math.random(10),filename:t.filename+"上传成功",path:a.path}):/(mp4|avi)/i.test(i)?t.video.push({id:Math.random(10),filename:t.filename+"上传成功",path:a.path}):t.otherFile.push({id:Math.random(10),filename:t.filename+"上传成功",path:a.path}),t.flag=!1,t.smallFile=!1,n.abrupt("return",!1);case 15:case"end":return n.stop()}}),n)})))()},changeFileAsBuffer:function(e){var t=this;return Object(a.a)(regeneratorRuntime.mark((function n(){var a,i,s,o,l,c,p,f,h;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,r(e,"buffer");case 4:for(a=n.sent,i=new u.a.ArrayBuffer,null,null,i.append(a),s=i.end(),o=/\.([0-9a-zA-Z]+)$/i.exec(e.name)[1],l=[],c=e.size/100,p=0,f=0;f<100;f++)h={chunk:e.slice(p,p+c),filename:"".concat(s,"_").concat(f,".").concat(o)},p+=c,l.push(h);t.partList=l,t.hash=s,t.sendRequest();case 18:case"end":return n.stop()}}),n)})))()},sendRequest:function(){var e=this;return Object(a.a)(regeneratorRuntime.mark((function t(){var n,r,i,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=[],e.partList.forEach((function(t,a){n.push((function(){var n=new FormData;return n.append("chunk",t.chunk),n.append("filename",t.filename),s.a.post("https://express-vue-components.herokuapp.com/single3",n,{headers:{"Content-Type":"multipart/form-data"}}).then((function(t){0==(t=t.data).code&&(e.total+=1,e.partList.splice(a,1))}))}))})),r=0,i=function(){var t=Object(a.a)(regeneratorRuntime.mark((function t(){var n,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.a.get("https://express-vue-components.herokuapp.com/merge",{params:{hash:e.hash}});case 2:if(0!=(n=(n=t.sent).data).code){t.next=10;break}return a=/\.([0-9a-zA-Z]+)$/.exec(n.path)[1],/(png|gif|jpeg|jpg)/i.test(a)?e.img.push({id:Math.random(10),path:n.path}):/(mp4|avi)/i.test(a)?e.video.push({id:Math.random(10),path:n.path}):e.otherFile.push({id:Math.random(10),filename:e.filename+"上传成功",path:n.path}),e.flag=!1,e.bigFile=!1,t.abrupt("return",!1);case 10:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),(o=function(){var t=Object(a.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.abort){t.next=2;break}return t.abrupt("return");case 2:if(!(r>=n.length)){t.next=5;break}return i(),t.abrupt("return");case 5:return t.next=7,n[r]();case 7:r++,o();case 9:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}())();case 6:case"end":return t.stop()}}),t)})))()},handleBtn:function(){if(this.btn)return this.abort=!1,this.btn=!1,void this.sendRequest();this.btn=!0,this.abort=!0}}},f=(n(574),n(52)),h={name:"uploaderApp",components:{"my-uploader":Object(f.a)(p,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"upload"},[n("div",{staticClass:"handle"},[n("input",{ref:"uploadOriginal",staticClass:"upload-original",attrs:{type:"file",disabled:e.flag},on:{change:e.changFile}}),e._v(" "),n("div",{staticClass:"el-upload_text",on:{click:e.clickUpload}},[e._v("点击上传")])]),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.smallFile,expression:"smallFile"}],staticClass:"progress"},[n("span",[e._v(e._s(e.filename)+"正在上传")])]),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.bigFile,expression:"bigFile"}],staticClass:"progress"},[n("span",[e._v("上传进度："+e._s(e._f("totalText")(e.total))+"%")]),e._v(" "),e.total>0&&e.total<100?n("el-link",{attrs:{type:"primary"},on:{click:e.handleBtn}},[e._v(e._s(e._f("btnText")(e.btn))+"\n    ")]):e._e()],1),e._v(" "),e.img.length>0?n("div",{staticClass:"uploadImg"},e._l(e.img,(function(t){return n("div",{key:t.id,staticClass:"img"},[n("img",{attrs:{src:t.path},on:{error:e.error}}),e._v(" "),n("span",{staticClass:"text",domProps:{textContent:e._s(t.filename)}})])})),0):e._e(),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.video.length>0,expression:"video.length > 0"}],staticClass:"uploadImg"},e._l(e.video,(function(t){return n("div",{key:t.id,staticClass:"img"},[n("video",{attrs:{src:t.path,controls:""}}),e._v(" "),n("span",{staticClass:"text",domProps:{textContent:e._s(t.filename)}})])})),0),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.otherFile.length>0,expression:"otherFile.length > 0"}],staticClass:"uploadImg"},e._l(e.otherFile,(function(t){return n("span",{key:t.id,staticClass:"text",attrs:{path:t.path},domProps:{textContent:e._s(t.filename)}})})),0)])}),[],!1,null,"ec1fd0e4",null).exports}},m=Object(f.a)(h,(function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("my-uploader",{attrs:{size:4096,bufferCount:20}})],1)}),[],!1,null,null,null);t.default=m.exports}}]);